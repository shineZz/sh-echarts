(function(h,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue"),require("@tarojs/taro")):typeof define=="function"&&define.amd?define(["exports","vue","@tarojs/taro"],o):(h=typeof globalThis<"u"?globalThis:h||self,o(h["yr-echarts"]={},h.Vue,h.Taro))})(this,function(h,o,y){"use strict";process.env.TARO_ENV==="alipay"&&Object.defineProperty(Object.prototype,"wx",{enumerable:!1,value:my});class S{constructor(n,i,c){this.ctx=n,this.chart=null,this.isNew=i,i?this.canvasNode=c:this._initStyle(n),this._initEvent()}getContext(n){if(n==="2d")return this.ctx}setChart(n){this.chart=n}addEventListener(){}attachEvent(){}detachEvent(){}_initCanvas(n,i){n.util.getContext=function(){return i},n.util.$override("measureText",function(c,r){return i.font=r||"12px sans-serif",i.measureText(c)})}_initStyle(n){n.createRadialGradient=()=>n.createCircularGradient(arguments)}_initEvent(){this.event={},[{wxName:"touchStart",ecName:"mousedown"},{wxName:"touchMove",ecName:"mousemove"},{wxName:"touchEnd",ecName:"mouseup"},{wxName:"touchEnd",ecName:"click"}].forEach(i=>{this.event[i.wxName]=c=>{const r=c.touches[0];this.chart.getZr().handler.dispatch(i.ecName,{zrX:i.wxName==="tap"?r.clientX:r.x,zrY:i.wxName==="tap"?r.clientY:r.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}})}})}set width(n){this.canvasNode&&(this.canvasNode.width=n)}set height(n){this.canvasNode&&(this.canvasNode.height=n)}get width(){return this.canvasNode?this.canvasNode.width:0}get height(){return this.canvasNode?this.canvasNode.height:0}}const k="",T={__name:"index",props:{uid:{type:String,default:""}},setup(f,{expose:n}){const i=f,c=require("./echarts.js");let r;o.onMounted(()=>{process.env.TARO_ENV!=="h5"&&c.registerPreprocessor(e=>{e&&e.series&&(e.series.length>0?e.series.forEach(t=>{t.progressive=0}):typeof e.series=="object"&&(e.series.progressive=0))})});const m=e=>{setTimeout(()=>{a(e)},100)};function a(e){const t=y.createSelectorQuery(),{uid:s}=i;t.select(`.${s}`).fields({node:!0,size:!0}).exec(u=>{const v=y.getSystemInfoSync().pixelRatio,p=u[0].node,g=u[0].width,z=u[0].height,_=p.getContext("2d"),l=new S(_,!0,p);c.setCanvasCreator(()=>l),typeof e=="function"&&(r=e(l,g,z,v))})}function d(e){for(let t=0;t<e.touches.length;++t){const s=e.touches[t];s.offsetX=s.x,s.offsetY=s.y}return e}function x(e){if(r&&e.touches.length>0){var t=e.touches[0],s=r.getZr().handler;s.dispatch("mousedown",{zrX:t.x,zrY:t.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}}),s.dispatch("mousemove",{zrX:t.x,zrY:t.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}}),s.processGesture(d(e),"start")}}function N(e){if(r&&e.touches.length>0){var t=e.touches[0],s=r.getZr().handler;s.dispatch("mousemove",{zrX:t.x,zrY:t.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}}),s.processGesture(d(e),"change")}}function w(e){if(r){const s=e.changedTouches?e.changedTouches[0]:{};var t=r.getZr().handler;t.dispatch("mouseup",{zrX:s.x,zrY:s.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}}),t.dispatch("click",{zrX:s.x,zrY:s.y,preventDefault:()=>{},stopImmediatePropagation:()=>{},stopPropagation:()=>{}}),t.processGesture(d(e),"end")}}return n({init:m}),(e,t)=>(o.openBlock(),o.createElementBlock("canvas",{type:"2d",class:o.normalizeClass([f.uid,"ec-canvas"]),"on:touchStart":x,"on:touchMove":N,"on:touchEnd":w},null,34))}},I="",b=["id"],O={__name:"index",setup(f,{expose:n}){const i=require("./echarts.js"),c=o.ref(process.env.TARO_ENV==="h5"),r=o.ref(`canvas-${Date.now()}-${Math.floor(Math.random()*1e4)}`),m=o.ref(null);let a=null;function d(){return a||console.error("echart 实例化还未完成，可参考使用说明：https://github.com/beezen/echarts4taro3#基础用法")}function x(e){if(!a)return console.error("echart 实例化还未完成，可参考使用说明：https://github.com/beezen/echarts4taro3#基础用法");a.setOption(e)}function N(e){if(!a)return console.error("echart 实例化还未完成，可参考使用说明：https://github.com/beezen/echarts4taro3#基础用法");a.resize({width:e.width,height:e.height})}function w(e,t){return new Promise(s=>{if(process.env.TARO_ENV==="h5"){const u=document.querySelector(`#${r.value}`);a=i.init(u),a.setOption(e),s(a)}else m.value.init((v,p,g,z)=>{if(a=i.init(v,null,{width:p,height:g,devicePixelRatio:z}),v.setChart(a),!p||!g){let _=0;const l=()=>{_++,y.createSelectorQuery().select(`.${r.value}`).fields({node:!0,size:!0}).exec(E=>{const P=E[0].width,C=E[0].height;(!P||!C)&&_<20?setTimeout(l,100):(a.resize({width:P,height:C}),a.setOption(e))})};l()}else a.setOption(e);return s(a),a})})}return n({getChart:d,setOption:x,resize:N,refresh:w}),(e,t)=>o.unref(c)?(o.openBlock(),o.createElementBlock("canvas",{key:0,id:o.unref(r),class:"echart-canvas"},null,8,b)):(o.openBlock(),o.createBlock(T,{key:1,ref_key:"canvas",ref:m,uid:o.unref(r),class:"echart-canvas"},null,8,["uid"]))}};h.EChart=O,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
